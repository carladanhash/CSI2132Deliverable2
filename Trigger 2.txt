Trigger 2: Preventing the Booking of Damaged Rooms

CREATE TRIGGER prevent_booking_of_damaged_rooms
BEFORE INSERT ON Booking 
REFERENCING NEW ROW AS new_row
FOR EACH ROW
WHEN EXISTS (
	SELECT 1 FROM Room 
	WHERE Room.RoomNumber = new_row.Room_Number 
	AND Room.Hotel_ID = new_row.Hotel_ID
	AND Room.Damages = 'Pending Repair'
)
BEGIN ATOMIC 
	SIGNAL SQLSTATE '45000'
	SET MESSAGE_TEXT = 'Cannot book room that contains unresolved damages.'
END;